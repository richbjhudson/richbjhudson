---
layout: post
title:  "Linux - How to a Setup a Kubernetes Cluster"
date:   2023-02-15 20:00 +0000
categories: Linux
---
# Lab Requirements
- 3 Virtual Machines with *Ubuntu 22.04.1 LTS* installed and a static IP address all residing on the same subnet.
  - A Controller with 2 vCPUs, 2GB vRAM and IP address 192.168.101.90.
  - 2 Nodes with 1 vCPU, 2GB vRAM and IP addresses 192.168.101.91 and 192.168.101.92.

# Steps
## Prerequisites to Setting up Kubernetes Cluster - Applies to all VMs
- Update the Operating System and packages using:
  - `sudo apt update`
  - `sudo apt dist-upgrade`
- Install a container runtime so that K8s may run containers:
  - `sudo apt install containerd`
  - `systemctl status containerd`
- Create a default configuration for *containerd*:
  - `sudo mkdir /etc/containerd`
  - `containerd config default | sudo tee /etc/containerd/config.toml`
- Set the *cgroup driver* to *systemd* by editing `sudo vi /etc/containerd/config.toml`:
  - Under `[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]` set `SystemCgroup = true`.
- Disable swap:
  - `sudo swapoff -a`
  - `free -m`
  - Comment out the *swap* entry within `/etc/fstab`.
- Enable network bridging by editing `sudo vi /etc/sysctl.conf` and set:
  - `net.ipv4.ip_forward=1`
- Enable Kernel moduleby editing `sudo vi /etc/modules-load.d/k8s.conf` and adding:
  - `br_netfilter`
- Reboot the Server.

## Installing K8s
